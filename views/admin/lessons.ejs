<%- include('../includes/head.ejs') %>
    </head>

    <body>
        <%- include('../includes/nav.ejs') %>

            <div class="container">
                <% if (messageInfo) { %>
                    <div class="mt-4 alert alert-success" role="alert"><%= messageInfo %></div>
                <% } %>
                <% if (messageErr) { %>
                    <div class="mt-4 alert alert-danger" role="alert"><%= messageErr %></div>
                <% } %>
                <% if (lessons.length > 0) { %>
                    <div class="list-group mt-4">
                        <% for (let lesson of lessons) { %>
                        <div class="list-group-item text-md-left text-center">
                            <div class="row">
                                <div class="col-md-3 text-md-left text-center">
                                    <%= lesson.date %>
                                </div>
                                <div class="col-md-3 text-md-left text-center">
                                    <%= lesson.maxSlots-lesson.participants.length %> su <%= lesson.maxSlots %> posti
                                </div>
                                <div class="col-md-2 text-md-left text-center">
                                    <%= lesson.type %>
                                </div>
                                <div class="col-md-4 text-md-left text-center">
                                    <a 
                                        class="btn btn-sm btn-outline-success" 
                                        data-toggle="collapse" href="#lessonPart_<%= lesson._id %>" role="button" aria-expanded="false" aria-controls="collapseExample"
                                        >Partecipanti</a>
                                    <a href="/admin/edit-lesson/<%= lesson._id %>?edit=1" class="btn btn-sm btn-outline-info">Modifica</a>
                                    <form action="/admin/delete-lesson" method="POST" style="display: inline;">
                                        <button class="btn btn-sm btn-outline-danger" type="submit">Elimina</button>
                                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                        <input type="hidden" name="lessonId" value="<%= lesson._id %>">
                                    </form>
                                </div>
                            </div>
                            <div class="collapse" id="lessonPart_<%= lesson._id %>">
                                <div class="row border-top mt-3 text-left">
                                    <ol class="mt-3">
                                        <% for(let partData of lesson.participants){ %>
                                            <li>
                                                <% if (partData.userId){ %> 
                                                    <%= partData.userId.name %> - <%= partData.userId.email %>
                                                <% }else{ %>
                                                    <%= partData.name %> (anonimo) %>
                                                <% } %>
                                            </li>
                                        <% } %>
                                    </ol>
                                </div>
                                <div class="row">
                                    <form action="/admin/reserve-anonym-slot" method="POST" class="form-inline mt-1">
                                        <div class="form-group mx-sm-3 mb-2">
                                            <input type="text" readonly class="form-control-plaintext" value="Prenotazione rapida">
                                        </div>
                                        <div class="form-group mx-sm-3 mb-2">
                                            <input name="name" type="text" class="form-control" placeholder="Nome" />
                                        </div>
                                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                        <input type="hidden" name="lessonId" value="<%= lesson._id %>">
                                        <button type="submit" class="btn btn-outline-info mb-2">Inserisci allievo</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <% } %>
                    </div>
                <% } else { %>
                    <h1>Nessuna pratica trovata!</h1>
                <% } %>
            </div>

        <%- include('../includes/end.ejs') %>